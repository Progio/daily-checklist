<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Break Habits</title>

<style>
:root{
  --bg:#0f1115;
  --card:rgba(255,255,255,0.06);
  --accent:#4CAF50;
  --text:#f2f2f7;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",sans-serif;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:520px;
  margin:auto;
  padding:18px;
}

/* iPhone-style glass cards */
.card{
  background:var(--card);
  backdrop-filter: blur(14px);
  border-radius:18px;
  padding:16px;
  margin-bottom:14px;
  box-shadow:0 4px 18px rgba(0,0,0,.25);
}

h2{
  text-align:center;
  font-weight:600;
}

input,textarea{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  background:rgba(255,255,255,0.08);
  color:var(--text);
  margin-bottom:12px;
  font-size:16px;
  box-sizing:border-box;
}

button{
  padding:12px;
  border:none;
  border-radius:12px;
  margin:5px 0;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
}

.primary{background:var(--accent);color:white;}
.secondary{background:#2a2d36;color:white;}
.danger{background:#a33;color:white;}

.small{font-size:13px;opacity:.85;}
.points{color:#9effa7;font-size:13px;}

canvas{
  width:100%;
  background:#16181f;
  border-radius:12px;
  margin-top:8px;
}
</style>
</head>

<body>
<div class="container">

<h2>üö´ Breaking Habits</h2>

<!-- Daily Devotional -->
<div class="card" id="devotional"></div>

<!-- Add Habit -->
<div class="card">
<input id="habitName" placeholder="Habit I'm quitting"/>
<textarea id="habitWhy" placeholder="Why do you want to quit?"></textarea>
<button class="primary" onclick="addHabit()">Add Habit</button>
</div>

<div id="encourage" class="card small">
Stay watchful and prayerful today.
</div>

<div id="habits"></div>

</div>

<script>
let habits = JSON.parse(localStorage.getItem("badHabits")||"[]");

/* Short accurate ESV quotes */
const verses=[
"Philippians 4:13 ‚Äî I can do all things through him who strengthens me.",
"James 4:7 ‚Äî Resist the devil, and he will flee from you.",
"2 Timothy 1:7 ‚Äî God gave us a spirit not of fear but of power, love, self-control.",
"John 16:33 ‚Äî Take heart; I have overcome the world."
];

const reflections=[
"Growth often comes quietly. Stay faithful today.",
"Temptation passes. Character remains.",
"God's strength shows most when ours feels weakest.",
"Small obedience builds big freedom."
];

function dailyDevotional(){
 const day=Math.floor(Date.now()/86400000);
 const v=verses[day%verses.length];
 const r=reflections[day%reflections.length];
 document.getElementById("devotional").innerHTML=
 "<b>Daily Devotional</b><br><br>"+v+
 "<br><br><span class='small'>"+r+"</span>";
}
dailyDevotional();

function save(){
 localStorage.setItem("badHabits",JSON.stringify(habits));
}

function showEncourage(text){
 document.getElementById("encourage").innerHTML=text;
}

function addHabit(){
 const name=document.getElementById("habitName").value.trim();
 const why=document.getElementById("habitWhy").value.trim();
 if(!name) return;

 habits.push({
  name,why,
  streak:0,longest:0,
  slips:0,urges:0,
  points:0,
  history:[],
  journal:[]
 });

 document.getElementById("habitName").value="";
 document.getElementById("habitWhy").value="";
 save();
 render();
}

function resisted(i){
 const h=habits[i];
 h.streak++;
 h.longest=Math.max(h.longest,h.streak);
 h.points+=10;
 h.history.push({s:h.streak});
 save();
 render();
}

function slipped(i){
 const h=habits[i];
 h.slips++;
 h.streak=0;
 showEncourage("Grace covers growth. Reflect and continue.<br>"+verses[Math.floor(Math.random()*verses.length)]);
 render(true,i);
}

function saveJournal(i){
 const text=document.getElementById("journal"+i).value;
 if(text){
  habits[i].journal.push(text);
  save();
  showEncourage("Reflection saved. Growth continues.");
 }
}

function urge(i){
 const h=habits[i];
 h.urges++;
 showEncourage("Pause 2 minutes.<br>"+h.why+"<br><br>"+verses[Math.floor(Math.random()*verses.length)]);
 save();
 render();
}

function deleteHabit(i){
 habits.splice(i,1);
 save();
 render();
}

function level(p){return Math.floor(p/100)+1;}

function render(showJournal=false,idx=null){
 const container=document.getElementById("habits");
 container.innerHTML="";

 habits.forEach((h,i)=>{
 container.innerHTML+=`
 <div class="card">
 <b>${h.name}</b>
 <div class="small">üî• ${h.streak} day streak</div>
 <div class="small">üèÜ Longest: ${h.longest}</div>
 <div class="small">‚ö†Ô∏è Slips: ${h.slips}</div>
 <div class="small">üß† Urges: ${h.urges}</div>
 <div class="points">‚≠ê Level ${level(h.points)}</div>

 <button class="primary" onclick="resisted(${i})">Resisted Today</button>
 <button class="secondary" onclick="urge(${i})">I'm Tempted</button>
 <button class="secondary" onclick="slipped(${i})">I Slipped</button>
 <button class="danger" onclick="deleteHabit(${i})">Delete</button>

 ${showJournal && idx===i ? `
 <textarea id="journal${i}" placeholder="What led to the slip? What can help next time?"></textarea>
 <button class="primary" onclick="saveJournal(${i})">Save Reflection</button>
 ` : ""}
 </div>
 `;
 });
}

render();
</script>
</body>
</html>
